<!DOCTYPE html><html lang="[&quot;en&quot;,&quot;zh-Hans&quot;,&quot;default&quot;]"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>FFmpeg常用命令 | 指间流沙</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">FFmpeg常用命令</h1><a id="logo" href="/.">指间流沙</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">FFmpeg常用命令</h1><div class="post-meta">Jan 9, 2018<span> | </span><span class="category"><a href="/categories/Technology/">Technology</a></span></div><div class="post-content"><p>&#x8BB0;&#x5F55;FFmpeg&#x5E38;&#x7528;&#x7684;&#x547D;&#x4EE4;&#xFF0C;&#x7559;&#x4F5C;&#x5907;&#x5FD8;&#x3002;</p>
<h4 id="1-&#x5C06;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x63A8;&#x6D41;&#x81F3;RTMP-Server&#xFF0C;&#x5E76;&#x5FAA;&#x73AF;&#x64AD;&#x653E;"><a href="#1-&#x5C06;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x63A8;&#x6D41;&#x81F3;RTMP-Server&#xFF0C;&#x5E76;&#x5FAA;&#x73AF;&#x64AD;&#x653E;" class="headerlink" title="1. &#x5C06;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x63A8;&#x6D41;&#x81F3;RTMP Server&#xFF0C;&#x5E76;&#x5FAA;&#x73AF;&#x64AD;&#x653E;"></a>1. &#x5C06;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x63A8;&#x6D41;&#x81F3;RTMP Server&#xFF0C;&#x5E76;&#x5FAA;&#x73AF;&#x64AD;&#x653E;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -stream_loop -1 -re -i ./file.mp4 -c copy -f flv &quot;rtmp://localhost:1935/live/video live=1 timeout=5&quot;</span><br></pre></td></tr></table></figure>
<h4 id="2-&#x5C06;&#x97F3;&#x9891;&#x6D41;&#x8F6C;&#x53D1;&#x5230;&#x5176;&#x4ED6;RTMP-Server"><a href="#2-&#x5C06;&#x97F3;&#x9891;&#x6D41;&#x8F6C;&#x53D1;&#x5230;&#x5176;&#x4ED6;RTMP-Server" class="headerlink" title="2. &#x5C06;&#x97F3;&#x9891;&#x6D41;&#x8F6C;&#x53D1;&#x5230;&#x5176;&#x4ED6;RTMP Server"></a>2. &#x5C06;&#x97F3;&#x9891;&#x6D41;&#x8F6C;&#x53D1;&#x5230;&#x5176;&#x4ED6;RTMP Server</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -probesize 1M -analyzeduration 5M &quot;rtmp://localhost:1935/live/audio1 live=1 timeout=5&quot; -c copy -f flv &quot;rtmp://localhost:1935/live/audio2 live=1 timeout=5&quot;</span><br></pre></td></tr></table></figure>
<h4 id="3-&#x5C06;&#x89C6;&#x9891;&#x7F29;&#x653E;&#x81F3;&#x6307;&#x5B9A;&#x5206;&#x8FA8;&#x7387;&#xFF08;640x320&#xFF09;&#xFF0C;&#x5BBD;&#x9AD8;&#x6BD4;&#x4E0D;&#x4E00;&#x81F4;&#x65F6;&#x586B;&#x5145;&#x9ED1;&#x8FB9;"><a href="#3-&#x5C06;&#x89C6;&#x9891;&#x7F29;&#x653E;&#x81F3;&#x6307;&#x5B9A;&#x5206;&#x8FA8;&#x7387;&#xFF08;640x320&#xFF09;&#xFF0C;&#x5BBD;&#x9AD8;&#x6BD4;&#x4E0D;&#x4E00;&#x81F4;&#x65F6;&#x586B;&#x5145;&#x9ED1;&#x8FB9;" class="headerlink" title="3. &#x5C06;&#x89C6;&#x9891;&#x7F29;&#x653E;&#x81F3;&#x6307;&#x5B9A;&#x5206;&#x8FA8;&#x7387;&#xFF08;640x320&#xFF09;&#xFF0C;&#x5BBD;&#x9AD8;&#x6BD4;&#x4E0D;&#x4E00;&#x81F4;&#x65F6;&#x586B;&#x5145;&#x9ED1;&#x8FB9;"></a>3. &#x5C06;&#x89C6;&#x9891;&#x7F29;&#x653E;&#x81F3;&#x6307;&#x5B9A;&#x5206;&#x8FA8;&#x7387;&#xFF08;640x320&#xFF09;&#xFF0C;&#x5BBD;&#x9AD8;&#x6BD4;&#x4E0D;&#x4E00;&#x81F4;&#x65F6;&#x586B;&#x5145;&#x9ED1;&#x8FB9;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i ./file.mp4 -vf &quot;scale=iw*min(640/iw\,360/ih):ih*min(640/iw\,360/ih),pad=640:360:(640-iw)/2:(320-ih)/2&quot; -c:v libx264 -crf 18 -c:a aac -f mp4 ./output.mp4</span><br></pre></td></tr></table></figure>
<h4 id="4-vf&#x548C;-filter-complex&#x7684;&#x533A;&#x522B;&#xFF1A;"><a href="#4-vf&#x548C;-filter-complex&#x7684;&#x533A;&#x522B;&#xFF1A;" class="headerlink" title="4. -vf&#x548C;-filter_complex&#x7684;&#x533A;&#x522B;&#xFF1A;"></a>4. <code>-vf</code>&#x548C;<code>-filter_complex</code>&#x7684;&#x533A;&#x522B;&#xFF1A;</h4><ul>
<li><p><code>-vf</code>&#x53EA;&#x80FD;&#x6784;&#x5EFA;&#x7B80;&#x5355;&#x7684;<code>filter graph</code>&#xFF0C;&#x5B83;&#x53EA;&#x5141;&#x8BB8;&#x6709;&#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x548C;&#x4E00;&#x4E2A;&#x8F93;&#x51FA;&#xFF0C;&#x5373;&#xFF1A;<code>ffmpeg</code>&#x7684;<code>-i</code>&#x53C2;&#x6570;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x3002;&#x4F46;&#x662F;&#xFF0C;&#x53EF;&#x4EE5;&#x5728;<code>-vf</code>&#x4E2D;&#x6DFB;&#x52A0;<code>amovie</code>&#x6216;<code>movie</code>&#x63D2;&#x4EF6;&#x5B9E;&#x73B0;&#x591A;&#x8F93;&#x5165;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i ./video.mp4 -vf &quot;movie=./image.jpg,scale=102x58[watermark];[in]scale=872x480[out];[out][watermark]overlay=0:422&quot; -c:v libx264 -c:a aac -f mp4 ./output.mp4 -y</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>-filter_complex</code>&#x53EF;&#x4EE5;&#x6784;&#x5EFA;&#x590D;&#x6742;&#x7684;<code>filter graph</code>&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x8BBE;&#x7F6E;&#x591A;&#x8F93;&#x5165;&#x548C;&#x591A;&#x8F93;&#x51FA;&#xFF0C;&#x4F8B;&#x5982;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i ./video.mp4 -i ./logo1.jpg -i ./logo2.jpg -filter_complex &quot;[0]scale=654:360[video0];[1]scale=39:36[watermark1];[video0][watermark1]overlay=19:14[video1];[2]scale=39:36[watermark2];[video1][watermark2]overlay=327:251[video2]&quot; -map [video2] -map 0:a? -c:v libx264 -c:a aac -f mp4 ./output.mp4 -y</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>&#x6CE8;&#x610F;&#xFF1A;</strong><code>-map 0:a?</code>&#x540E;&#x9762;&#x7684;<code>?</code>&#x8868;&#x793A;&#x5982;&#x679C;&#x97F3;&#x9891;&#x6D41;&#x4E0D;&#x5B58;&#x5728;&#xFF0C;&#x5219;&#x8BE5;<code>-map</code>&#x53C2;&#x6570;&#x53EF;&#x4EE5;&#x88AB;&#x5FFD;&#x7565;&#xFF0C;ffmpeg&#x53EF;&#x4EE5;&#x7EE7;&#x7EED;&#x6267;&#x884C;&#x540E;&#x7EED;&#x52A8;&#x4F5C;&#x3002;&#x53E6;&#x5916;&#xFF0C;<code>?</code>&#x53EA;&#x80FD;&#x5FFD;&#x7565;&#x4E0D;&#x5B58;&#x5728;&#x7684;<code>stream</code>&#xFF0C;&#x5982;&#x679C;<code>input</code>&#x4E0D;&#x5B58;&#x5728;&#x4ECD;&#x7136;&#x4F1A;&#x5BFC;&#x81F4;ffmpeg&#x9000;&#x51FA;&#xFF0C;&#x5373;<code>0</code>&#x5FC5;&#x987B;&#x662F;&#x6709;&#x6548;&#x7684;<code>input file</code>&#x3002;</p>
</blockquote>
</li>
</ul>
<h2 id="5-Speeding-up-slowing-down-video&#xFF0C;&#x4F7F;&#x7528;setpts&#x63D2;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x8BE5;&#x63D2;&#x4EF6;&#x4EC5;&#x4FEE;&#x6539;&#x89C6;&#x9891;&#x901F;&#x7387;&#xFF0C;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x97F3;&#x9891;&#x901F;&#x7387;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;-an&#x9759;&#x97F3;&#x3002;"><a href="#5-Speeding-up-slowing-down-video&#xFF0C;&#x4F7F;&#x7528;setpts&#x63D2;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x8BE5;&#x63D2;&#x4EF6;&#x4EC5;&#x4FEE;&#x6539;&#x89C6;&#x9891;&#x901F;&#x7387;&#xFF0C;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x97F3;&#x9891;&#x901F;&#x7387;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;-an&#x9759;&#x97F3;&#x3002;" class="headerlink" title="5. Speeding up / slowing down video&#xFF0C;&#x4F7F;&#x7528;setpts&#x63D2;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x8BE5;&#x63D2;&#x4EF6;&#x4EC5;&#x4FEE;&#x6539;&#x89C6;&#x9891;&#x901F;&#x7387;&#xFF0C;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x97F3;&#x9891;&#x901F;&#x7387;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;-an&#x9759;&#x97F3;&#x3002;"></a>5. Speeding up / slowing down video&#xFF0C;&#x4F7F;&#x7528;<code>setpts</code>&#x63D2;&#x4EF6;&#xFF0C;&#x800C;&#x4E14;&#x8BE5;&#x63D2;&#x4EF6;&#x4EC5;&#x4FEE;&#x6539;&#x89C6;&#x9891;&#x901F;&#x7387;&#xFF0C;&#x4E0D;&#x4F1A;&#x6539;&#x53D8;&#x97F3;&#x9891;&#x901F;&#x7387;&#xFF0C;&#x56E0;&#x6B64;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>-an</code>&#x9759;&#x97F3;&#x3002;</h2><ul>
<li><p>2&#x500D;&#x901F;&#x7387;&#x3002;&#x52A0;&#x901F;&#x540E;FFmpeg&#x5C06;&#x629B;&#x5F03;&#x90E8;&#x5206;frame&#xFF0C;&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x4E22;&#x5E27;&#xFF0C;&#x53EF;&#x4EE5;&#x5C06;frame rate&#x8BBE;&#x7F6E;&#x4E3A;&#x539F;&#x6765;2&#x500D;&#xFF08;&#x5982;&#xFF1A;&#x539F;&#x89C6;&#x9891;&#x662F;15 fps&#xFF09;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mkv -r 30 -filter:v &quot;setpts=0.5*PTS&quot; output.mkv</span><br></pre></td></tr></table></figure>
</li>
<li><p>0.5&#x500D;&#x901F;&#x7387;&#xFF08;&#x6162;&#x901F;&#xFF09;&#x3002;&#x8BBE;&#x7F6E;<code>PTS</code>&#x503C;&#x5927;&#x4E8E;1&#x5373;&#x53EF;&#x8FBE;&#x5230;&#x6162;&#x901F;&#x6548;&#x679C;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mkv -filter:v &quot;setpts=2.0*PTS&quot; output.mkv</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>&#x6CE8;&#x610F;1&#xFF1A;</strong>&#x4F7F;&#x7528;<code>setpts</code>&#x63D2;&#x4EF6;&#x52A0;&#x901F;&#x89C6;&#x9891;&#x65F6;&#xFF0C;FFmpeg&#x9700;&#x8981;&#x5FEB;&#x901F;&#x7684;&#x8BFB;&#x53D6;&#x6587;&#x4EF6;&#xFF0C;&#x56E0;&#x6B64;&#x4E0D;&#x80FD;&#x4E0E;<code>-re</code>&#xFF08;&#x6309;&#x7167;&#x89C6;&#x9891;&#x5E27;&#x7387;&#x8BFB;&#x53D6;&#x5185;&#x5BB9;&#xFF09;&#x9009;&#x9879;&#x5171;&#x7528;&#x3002;</p>
<p><strong>&#x6CE8;&#x610F;2&#xFF1A;</strong>&#x4F7F;&#x7528;<code>setpts</code>&#x63D2;&#x4EF6;&#x5C06;&#x5BFC;&#x81F4;&#x89C6;&#x9891;&#x91CD;&#x7F16;&#x7801;&#xFF0C;&#x56E0;&#x6B64;&#xFF0C;&#x4F7F;&#x7528;&#x65F6;&#x5EFA;&#x8BAE;&#x6DFB;&#x52A0;<code>-c:v libx264 -crf 18</code>&#x53C2;&#x6570;&#x63D0;&#x5347;&#x7F16;&#x7801;&#x8D28;&#x91CF;&#x3002;</p>
</blockquote>
</li>
</ul>
<h3 id="6-Speeding-up-slowing-down-audio&#xFF0C;&#x4F7F;&#x7528;atempo&#x63D2;&#x4EF6;&#x3002;&#x8BE5;&#x63D2;&#x4EF6;&#x53EA;&#x80FD;&#x8BBE;&#x7F6E;-0-5-2-0-&#x8303;&#x56F4;&#x7684;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8BBE;&#x7F6E;&#x66F4;&#x5927;&#x8303;&#x56F4;&#x7684;&#x901F;&#x7387;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;chain-filter&#x65B9;&#x5F0F;&#x3002;"><a href="#6-Speeding-up-slowing-down-audio&#xFF0C;&#x4F7F;&#x7528;atempo&#x63D2;&#x4EF6;&#x3002;&#x8BE5;&#x63D2;&#x4EF6;&#x53EA;&#x80FD;&#x8BBE;&#x7F6E;-0-5-2-0-&#x8303;&#x56F4;&#x7684;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8BBE;&#x7F6E;&#x66F4;&#x5927;&#x8303;&#x56F4;&#x7684;&#x901F;&#x7387;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;chain-filter&#x65B9;&#x5F0F;&#x3002;" class="headerlink" title="6. Speeding up / slowing down audio&#xFF0C;&#x4F7F;&#x7528;atempo&#x63D2;&#x4EF6;&#x3002;&#x8BE5;&#x63D2;&#x4EF6;&#x53EA;&#x80FD;&#x8BBE;&#x7F6E;[0.5 - 2.0]&#x8303;&#x56F4;&#x7684;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8BBE;&#x7F6E;&#x66F4;&#x5927;&#x8303;&#x56F4;&#x7684;&#x901F;&#x7387;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;chain filter&#x65B9;&#x5F0F;&#x3002;"></a>6. Speeding up / slowing down audio&#xFF0C;&#x4F7F;&#x7528;<code>atempo</code>&#x63D2;&#x4EF6;&#x3002;&#x8BE5;&#x63D2;&#x4EF6;&#x53EA;&#x80FD;&#x8BBE;&#x7F6E;<code>[0.5 - 2.0]</code>&#x8303;&#x56F4;&#x7684;&#x503C;&#xFF0C;&#x5982;&#x679C;&#x60F3;&#x8BBE;&#x7F6E;&#x66F4;&#x5927;&#x8303;&#x56F4;&#x7684;&#x901F;&#x7387;&#xFF0C;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;<code>chain filter</code>&#x65B9;&#x5F0F;&#x3002;</h3><ul>
<li><p>4&#x500D;&#x901F;&#x7387;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mkv -filter:a &quot;atempo=2.0,atempo=2.0&quot; -vn output.mkv</span><br></pre></td></tr></table></figure>
</li>
<li><p>&#x540C;&#x65F6;&#x8C03;&#x6574;&#x89C6;&#x9891;&#x548C;&#x97F3;&#x9891;&#x7684;&#x901F;&#x7387;&#xFF08;2&#x500D;&#x901F;&#x7387;&#xFF09;&#xFF1A;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mkv -filter_complex &quot;[0:v]setpts=0.5*PTS[v];[0:a]atempo=2.0[a]&quot; -map &quot;[v]&quot; -map &quot;[a]&quot; output.mkv</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="7-&#x89C6;&#x9891;&#x663E;&#x793A;&#x5927;&#x5C0F;&#x7531;&#x5206;&#x8FA8;&#x7387;&#x548C;&#x5BBD;&#x9AD8;&#x6BD4;&#x51B3;&#x5B9A;&#xFF0C;ffmpeg&#x63D0;&#x4F9B;&#x5BBD;&#x9AD8;&#x503C;&#xFF0C;SAR&#x548C;DAR&#x53C2;&#x6570;&#x63A7;&#x5236;&#x89C6;&#x9891;&#x663E;&#x793A;&#x5927;&#x5C0F;&#x3002;"><a href="#7-&#x89C6;&#x9891;&#x663E;&#x793A;&#x5927;&#x5C0F;&#x7531;&#x5206;&#x8FA8;&#x7387;&#x548C;&#x5BBD;&#x9AD8;&#x6BD4;&#x51B3;&#x5B9A;&#xFF0C;ffmpeg&#x63D0;&#x4F9B;&#x5BBD;&#x9AD8;&#x503C;&#xFF0C;SAR&#x548C;DAR&#x53C2;&#x6570;&#x63A7;&#x5236;&#x89C6;&#x9891;&#x663E;&#x793A;&#x5927;&#x5C0F;&#x3002;" class="headerlink" title="7. &#x89C6;&#x9891;&#x663E;&#x793A;&#x5927;&#x5C0F;&#x7531;&#x5206;&#x8FA8;&#x7387;&#x548C;&#x5BBD;&#x9AD8;&#x6BD4;&#x51B3;&#x5B9A;&#xFF0C;ffmpeg&#x63D0;&#x4F9B;&#x5BBD;&#x9AD8;&#x503C;&#xFF0C;SAR&#x548C;DAR&#x53C2;&#x6570;&#x63A7;&#x5236;&#x89C6;&#x9891;&#x663E;&#x793A;&#x5927;&#x5C0F;&#x3002;"></a>7. &#x89C6;&#x9891;&#x663E;&#x793A;&#x5927;&#x5C0F;&#x7531;&#x5206;&#x8FA8;&#x7387;&#x548C;&#x5BBD;&#x9AD8;&#x6BD4;&#x51B3;&#x5B9A;&#xFF0C;ffmpeg&#x63D0;&#x4F9B;&#x5BBD;&#x9AD8;&#x503C;&#xFF0C;SAR&#x548C;DAR&#x53C2;&#x6570;&#x63A7;&#x5236;&#x89C6;&#x9891;&#x663E;&#x793A;&#x5927;&#x5C0F;&#x3002;</h4><ul>
<li>DAR - Display Aspect Ratio &#x663E;&#x793A;&#x6A2A;&#x7EB5;&#x6BD4;&#x3002;&#x6700;&#x7EC8;&#x663E;&#x793A;&#x7684;&#x56FE;&#x50CF;&#x5728;&#x957F;&#x5EA6;&#x5355;&#x4F4D;&#x4E0A;&#x7684;&#x6A2A;&#x7EB5;&#x6BD4;&#x3002;</li>
<li>SAR - Sample Aspect Ratio &#x91C7;&#x6837;&#x6A2A;&#x7EB5;&#x6BD4;&#x3002;&#x8868;&#x793A;&#x6A2A;&#x5411;&#x50CF;&#x7D20;&#x70B9;&#x6570;&#x548C;&#x7EB5;&#x5411;&#x50CF;&#x7D20;&#x70B9;&#x6570;&#x7684;&#x6BD4;&#x503C;&#x3002;</li>
<li><code>DAR = HORIZONTAL_RESOLUTION / VERTICAL_RESOLUTION * SAR</code></li>
<li><strong>&#x6CE8;&#x610F;&#xFF1A;</strong>&#x5982;&#x679C;&#x89C6;&#x9891;&#x4E0D;&#x542B;DAR&#x548C;SAR&#x4FE1;&#x606F;&#xFF0C;&#x4F7F;&#x7528;ffprobe&#x67E5;&#x770B;&#x5219;&#x663E;&#x793A;&#x4E3A;<code>1:0</code>&#x3002;</li>
</ul>
<p>&#x5C06;test.mp4&#x6309;&#x7167;&#x539F;&#x663E;&#x793A;&#x7EB5;&#x6A2A;&#x6BD4;&#x7B49;&#x6BD4;&#x7F29;&#x653E;&#x81F3;640x360&#xFF08;16:9&#xFF09;&#xFF0C;&#x5982;&#x679C;&#x7EB5;&#x6A2A;&#x6BD4;&#x4E0D;&#x4E00;&#x81F4;&#x5219;&#x6DFB;&#x52A0;&#x9ED1;&#x8FB9;&#x3002;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i test.mp4 -vf &quot;[0]scale=iw*min(sar\,1)*min(640/iw/min(sar\,1)\,360/ih*max(sar\,1)):ih/max(sar\,1)*min(640/iw/min(sar\,1)\,360/ih*max(sar\,1)),pad=640:360:(640-iw)/2:(360-ih)/2[video0]&quot; -map [video0] -map 0:a? -c:v h264 -b:v 120k -c:a aac -b:a 64k -g 30 -max_muxing_queue_size 512 -y out.mp4</span><br></pre></td></tr></table></figure>
<h4 id="8-&#x4F7F;mp4&#x652F;&#x6301;&#x6E10;&#x8FDB;&#x5F0F;&#x4E0B;&#x8F7D;&#xFF0C;&#x4F7F;&#x7528;-movflags-faststart&#x547D;&#x4EE4;&#x5C06;metadata&#xFF08;moov&#xFF09;&#x653E;&#x5728;data&#x4E4B;&#x524D;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;-movflags-frag-keyframe&#x4EE5;fragmented&#xFF08;moof&#xFF09;&#x65B9;&#x5F0F;&#x7EC4;&#x7EC7;box"><a href="#8-&#x4F7F;mp4&#x652F;&#x6301;&#x6E10;&#x8FDB;&#x5F0F;&#x4E0B;&#x8F7D;&#xFF0C;&#x4F7F;&#x7528;-movflags-faststart&#x547D;&#x4EE4;&#x5C06;metadata&#xFF08;moov&#xFF09;&#x653E;&#x5728;data&#x4E4B;&#x524D;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;-movflags-frag-keyframe&#x4EE5;fragmented&#xFF08;moof&#xFF09;&#x65B9;&#x5F0F;&#x7EC4;&#x7EC7;box" class="headerlink" title="8. &#x4F7F;mp4&#x652F;&#x6301;&#x6E10;&#x8FDB;&#x5F0F;&#x4E0B;&#x8F7D;&#xFF0C;&#x4F7F;&#x7528;-movflags faststart&#x547D;&#x4EE4;&#x5C06;metadata&#xFF08;moov&#xFF09;&#x653E;&#x5728;data&#x4E4B;&#x524D;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;-movflags frag_keyframe&#x4EE5;fragmented&#xFF08;moof&#xFF09;&#x65B9;&#x5F0F;&#x7EC4;&#x7EC7;box"></a>8. &#x4F7F;mp4&#x652F;&#x6301;&#x6E10;&#x8FDB;&#x5F0F;&#x4E0B;&#x8F7D;&#xFF0C;&#x4F7F;&#x7528;<code>-movflags faststart</code>&#x547D;&#x4EE4;&#x5C06;metadata&#xFF08;moov&#xFF09;&#x653E;&#x5728;data&#x4E4B;&#x524D;&#xFF0C;&#x6216;&#x8005;&#x4F7F;&#x7528;<code>-movflags frag_keyframe</code>&#x4EE5;fragmented&#xFF08;moof&#xFF09;&#x65B9;&#x5F0F;&#x7EC4;&#x7EC7;box</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">file -&gt; file:</span><br><span class="line">ffmpeg -i test.mp4 -c copy -movflags faststart test_progress.mp4</span><br><span class="line">ffmpeg -i test.mp4 -c copy -movflags frag_keyframe test_fragmented.mp4</span><br><span class="line"></span><br><span class="line">stream -&gt; segments:</span><br><span class="line">ffmpeg -i rtmp://localhost/live/test -c copy -f segment -segment_time 5 -segment_format_options movflags=frag_keyframe test%d.mp4</span><br><span class="line">ffmpeg -i rtmp://localhost/live/test -c copy -f segment -segment_time 5 -segment_format_options movflags=frag_keyframe test%d.mp4</span><br></pre></td></tr></table></figure>
<h4 id="9-&#x63D0;&#x53D6;&#x89C6;&#x9891;&#x5173;&#x952E;&#x5E27;"><a href="#9-&#x63D0;&#x53D6;&#x89C6;&#x9891;&#x5173;&#x952E;&#x5E27;" class="headerlink" title="9. &#x63D0;&#x53D6;&#x89C6;&#x9891;&#x5173;&#x952E;&#x5E27;"></a>9. &#x63D0;&#x53D6;&#x89C6;&#x9891;&#x5173;&#x952E;&#x5E27;</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -v debug -i video.webm -vf &quot;select=eq(pict_type\,I)&quot; -vsync vfr thumb%04d.jpg -hide_banner 2&gt; log.txt</span><br></pre></td></tr></table></figure>
<ul>
<li>-vsync vfr: This is a parameter that tells the filter to use a variable bitrate video synchronization. If we do not use this parameter ffmpeg will fail to find only the keyframes and shoud extract other frames that can be not processed correctly.</li>
<li>-v debug: You can use the detail log to find the time stamp of the key frame.</li>
</ul>
</div><div class="tags"><a href="/tags/FFmpeg/">FFmpeg</a></div><div class="post-nav"><a class="pre" href="/2018/01/09/ffprobe-commands/">FFprobe常用命令</a><a class="next" href="/2017/08/03/debian-hash-sum-mismatch/">Ubuntu/Debian使用代理时apt遇到Hash sum mismatch解决方法</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://stillwuyan.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Technology/">Technology</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Vim/" style="font-size: 15px;">Vim</a> <a href="/tags/CentOS/" style="font-size: 15px;">CentOS</a> <a href="/tags/Debian/" style="font-size: 15px;">Debian</a> <a href="/tags/Ubuntu/" style="font-size: 15px;">Ubuntu</a> <a href="/tags/apt-get/" style="font-size: 15px;">apt-get</a> <a href="/tags/Redis/" style="font-size: 15px;">Redis</a> <a href="/tags/UEFI/" style="font-size: 15px;">UEFI</a> <a href="/tags/Keepalived/" style="font-size: 15px;">Keepalived</a> <a href="/tags/FFprobe/" style="font-size: 15px;">FFprobe</a> <a href="/tags/FFmpeg/" style="font-size: 15px;">FFmpeg</a> <a href="/tags/SSR/" style="font-size: 15px;">SSR</a> <a href="/tags/Proxychains/" style="font-size: 15px;">Proxychains</a> <a href="/tags/iptabels/" style="font-size: 15px;">iptabels</a> <a href="/tags/Kubernetes/" style="font-size: 15px;">Kubernetes</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/06/05/use-iptabels-set-gateway/">使用CentOS 7搭建网关服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/18/install-k8s-on-centos7/">CentOS 7安装Kubernetes</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/17/install-ssr-and-proxychains-on-centos7/">CentOS 7安装SSR Client和ProxyChains</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/09/ffprobe-commands/">FFprobe常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/09/ffmpeg-commands/">FFmpeg常用命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/03/debian-hash-sum-mismatch/">Ubuntu/Debian使用代理时apt遇到Hash sum mismatch解决方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/03/nginx-and-keepalived-configuration/">Nginx+Keepalived实现高可用负载均衡服务</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/08/02/redis-usage/">Redis使用汇总</a></li><li class="post-list-item"><a class="post-list-link" href="/2017/02/04/install-centos7-in-uefi-mode/">UEFI安装CentOS 7</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/09/vim-operation/">Vim常用操作</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Links</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">指间流沙.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>